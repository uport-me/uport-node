<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>uPort Example</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script type="text/javascript" src="https://unpkg.com/uport-connect/dist/uport-connect.js"></script>
    <style>
      main { padding: 10px 30px; }
      header { background: #EEE; }
      .btn-sm{ padding: 3px 10px;
               border-radius: 0; }
    </style>
  </head>
  <body>
    <main>
      <header><h1 id="dappName">Uport Auth Server Example</h1></header>
      <hr/>
      <section>
        <h2>Connect uPort</h2>
        <table>
          <tobdy>
            <tr><td><span>Auth Status: </span><span id="authStatus"></span></td></tr>
            <tr><td><span>Address: </span><span id="addr"></span></td></tr>
            <tr><td><span>Name: </span><span id="name"></span></td></tr>
          </tobdy>
        <table>
        <button class="btn btn-sm btn-primary" id="connectUportBtn" onclick="loginBtnClick()">Connect uPort</button>
      </section>
    </main>
    <script>
      // DOM Selector Shortcut for this example
      let $ = (selector) => document.querySelector(selector)

      // App Setup
      let uport = new uportconnect.Connect()
      // Set your server host/port
      const reqUrl  = 'your-url-to-fetch-requests/authRequest'
      const authUrl = 'your-url-to-verify-response/auth'
      let resUrl   = 'your-url-to-fetch-your-response/authResponse'

      function loginBtnClick () {
        function reqListener () {
          const resObj = JSON.parse(this.responseText)
          const token = resObj.message
          const pairId = resObj.pairId

          resUrl = resUrl + pairId

            uport.sendRequestToken({token, resUrl, authUrl}).then(res => {
            console.log(JSON.stringify(res))
            $('#addr').textContent = res.credentials.address
            $('#name').textContent = res.credentials.name
            $('#authStatus').textContent = res.message.status
          })
         }

        // Make request to server, get JWT back
        const req = new XMLHttpRequest();
        req.addEventListener("load", reqListener);
        req.open('GET', reqUrl);
        req.send();
      }

    </script>
  </body>
</html>
